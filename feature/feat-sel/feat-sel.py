import sys
from sklearn.ensemble import ExtraTreesClassifier
from sklearn.metrics import roc_auc_score,mean_absolute_error,r2_score,mean_squared_error
import numpy as np
import pickle

X=[]
Y=[]
L=[]
trainf=open(sys.argv[1])
for l in trainf.readlines():
    sl = l.strip().split()
    L.append(sl[0])
    Y.append(int(sl[1]))
    xx=map(float,sl[2:])
    #xx=map(float,sl[12:])
    X.append(xx)

print len(X), len(X[0])
clf = ExtraTreesClassifier(n_estimators=50, max_depth=8, bootstrap=True)
clf = clf.fit(X, Y)
#print ' '.join([str(i) for i in clf.feature_importances_])
#for i,j in enumerate(clf.feature_importances_): print i, j
XX=clf.transform(X)
print XX.shape

with open(sys.argv[2],'w') as mf:
    for l in xrange(0, len(L)):
        mf.write('%s %d %s\n'%(L[l], Y[l], ' '.join([str(xx) for xx in XX[l]])))

pf=open('feat-sel.pkl','w')
s = pickle.dump(clf, pf)
pf.close()

